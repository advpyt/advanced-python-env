{#
  Book list page for the Library Management System.

  Displays all books in the catalog and allows filtering by category.
  Shows the number of available copies for each book and links to the
  book detail page.
#}

{% extends 'library/base.html' %}

{% block title %}Library Catalog{% endblock %}

{% block content %}
<h1>Library Catalog</h1>

<form method="get">
    <label for="category">Category:</label>
    <select name="category" id="category" onchange="this.form.submit()">
        <option value="">All</option>
        {% for c in categories %}
            <option value="{{ c.id }}"{% if selected_category == c.id|stringformat:'s' %} selected{% endif %}>
                {{ c.name }}
            </option>
        {% endfor %}
    </select>
    <noscript><button type="submit">Filter</button></noscript>
</form>

{% if books %}
    <table class="catalog-table">
        <thead>
            <tr>
                <th>Title</th>
                <th>Author</th>
                <th>Category</th>
                <th>Available</th>
            </tr>
        </thead>
        <tbody>
            {% for book in books %}
                <tr>
                    <td><a href="{% url 'library:book_detail' book.id %}">{{ book.title }}</a></td>
                    <td>{{ book.author }}</td>
                    <td>{{ book.category.name }}</td>
                    <td>{{ book.available_copies }}/{{ book.total_copies }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No books in the catalog.</p>
{% endif %}

{% endblock %}