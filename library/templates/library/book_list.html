{% extends 'library/base.html' %}
{% load static %}
{% block title %}Library Catalog{% endblock %}

{% block content %}
<h1>Library Catalog</h1>

<form method="get">
    <label for="category">Category:</label>
    <select name="category" id="category" onchange="this.form.submit()">
        <option value="">All</option>
        {% for c in categories %}
            <option value="{{ c.id }}"{% if selected_category == c.id|stringformat:'s' %} selected{% endif %}>
                {{ c.name }}
            </option>
        {% endfor %}
    </select>
    <noscript><button type="submit">Filter</button></noscript>
</form>

{% if books %}
    <div class="book-grid">
        {% for book in books %}
        <div class="book-card">
            {% if book.cover_image %}
                <img src="{{ book.cover_image.url }}" alt="{{ book.title }}">
            {% else %}
                <img src="{% static 'images/default_cover.png' %}" alt="{{ book.title }}">
            {% endif %}
            <h3><a href="{% url 'library:book_detail' book.id %}">{{ book.title }}</a></h3>
            <p>Author: {{ book.author }}</p>
            <p>Category: {{ book.category.name }}</p>
            <p>Available: {{ book.available_copies }}/{{ book.total_copies }}</p>
            <a class="button" href="{% url 'library:book_detail' book.id %}">View Details</a>
        </div>
        {% endfor %}
    </div>
{% else %}
    <p>No books in the catalog.</p>
{% endif %}

{% endblock %}